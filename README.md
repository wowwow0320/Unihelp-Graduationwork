# PDF ê¸°ë°˜ RAG ì±—ë´‡ API (FastAPI)

ì´ í”„ë¡œì íŠ¸ëŠ” FastAPIë¥¼ ì‚¬ìš©í•˜ì—¬ PDF ë¬¸ì„œì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ì§ˆë¬¸ì— ë‹µë³€í•˜ëŠ” RAG(Retrieval-Augmented Generation) ì±—ë´‡ APIë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ê³ ìœ í•œ ì´ë¦„ì˜ 'ì»¬ë ‰ì…˜'ì„ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ê°œë°œìëŠ” ì„¤ì • íŒŒì¼ì—ì„œ íŠ¹ì • ì»¬ë ‰ì…˜ì„ ì§€ì •í•˜ì—¬ ì±—ë´‡ì˜ ì§€ì‹ ë² ì´ìŠ¤ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

* **ë™ì  ì§€ì‹ ë² ì´ìŠ¤**: PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ ë…ë¦½ëœ ì§€ì‹ ì»¬ë ‰ì…˜ì„ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **MVC ìœ ì‚¬ ì•„í‚¤í…ì²˜**: `routers`, `services`, `models` ë“± ì„œë¹„ìŠ¤ ì§€í–¥ì ì¸ êµ¬ì¡°ë¡œ ì½”ë“œë¥¼ êµ¬ì„±í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì™€ í™•ì¥ì´ ìš©ì´í•©ë‹ˆë‹¤.
* **ì‰¬ìš´ ì§€ì‹ ë² ì´ìŠ¤ ì „í™˜**: ê°œë°œìëŠ” `.env` íŒŒì¼ì˜ `DEFAULT_DB_COLLECTION_NAME` ê°’ ë³€ê²½ë§Œìœ¼ë¡œ ì±—ë´‡ì´ ì‚¬ìš©í•˜ëŠ” ì§€ì‹ ë² ì´ìŠ¤ë¥¼ ì†ì‰½ê²Œ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ìë™í™”ëœ ë¬¸ì„œ ì²˜ë¦¬**: PDFì—ì„œ í…ìŠ¤íŠ¸ì™€ í…Œì´ë¸”ì„ ì¶”ì¶œí•˜ì—¬ RAGì— ìµœì í™”ëœ í˜•ì‹ìœ¼ë¡œ ìë™ ë³€í™˜í•˜ê³  ë²¡í„° DBì— ì €ì¥í•©ë‹ˆë‹¤.
* **API ë¬¸ì„œ ìë™ ìƒì„±**: FastAPIì˜ ë‚´ì¥ ê¸°ëŠ¥ì„ í†µí•´ `http://127.0.0.1:8000/docs`ì—ì„œ Swagger UI ë¬¸ì„œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸš€ ì‹œì‘í•˜ê¸°

ì´ ì„¹ì…˜ì—ì„œëŠ” í”„ë¡œì íŠ¸ë¥¼ ë¡œì»¬ í™˜ê²½ì—ì„œ ì„¤ì •í•˜ê³  ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

### 1. ì‚¬ì „ ìš”êµ¬ì‚¬í•­

* **Python 3.9 ì´ìƒ**: [Python ê³µì‹ ì›¹ì‚¬ì´íŠ¸](https://www.python.org/downloads/)ì—ì„œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **API í‚¤**:
    * **OpenAI API Key**: [OpenAI ì›¹ì‚¬ì´íŠ¸](https://platform.openai.com/api-keys)ì—ì„œ ë°œê¸‰ë°›ìœ¼ì„¸ìš”.
    * **LlamaParse API Key**: [LlamaCloud](https://cloud.llamaindex.ai/)ì— ê°€ì…í•˜ì—¬ ë°œê¸‰ë°›ìœ¼ì„¸ìš”. (PDF íŒŒì‹±ì— ì‚¬ìš©ë©ë‹ˆë‹¤.)

### 2. í”„ë¡œì íŠ¸ ì„¤ì •

#### (1) ê°€ìƒ í™˜ê²½ ìƒì„± ë° í™œì„±í™”

í”„ë¡œì íŠ¸ ì˜ì¡´ì„±ì„ ì‹œìŠ¤í…œì˜ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì™€ ê²©ë¦¬í•˜ê¸° ìœ„í•´ ê°€ìƒ í™˜ê²½ì„ ìƒì„±í•˜ê³  í™œì„±í™”í•©ë‹ˆë‹¤.

```bash
# 1. 'venv'ë¼ëŠ” ì´ë¦„ì˜ ê°€ìƒ í™˜ê²½ ìƒì„±
python -m venv venv

# 2. ê°€ìƒ í™˜ê²½ í™œì„±í™”
# Windowsì˜ ê²½ìš°
.\venv\Scripts\activate
# macOS / Linuxì˜ ê²½ìš°
source venv/bin/activate
```

ê°€ìƒ í™˜ê²½ì´ í™œì„±í™”ë˜ë©´ í„°ë¯¸ë„ í”„ë¡¬í”„íŠ¸ ì•ì— `(venv)`ê°€ í‘œì‹œë©ë‹ˆë‹¤.

#### (2) ì˜ì¡´ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

í”„ë¡œì íŠ¸ì— í•„ìš”í•œ ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ `requirements.txt` íŒŒì¼ì„ ì´ìš©í•´ í•œ ë²ˆì— ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
pip install -r requirements.txt
```

#### (3) í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (`.env` íŒŒì¼)

í”„ë¡œì íŠ¸ ìµœìƒìœ„ ê²½ë¡œì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ê·¸ë¦¬ê³  **ì‹¤ì œ API í‚¤ë¥¼ ì…ë ¥**í•´ì•¼ í•©ë‹ˆë‹¤.

```text
# .env

# --- AI Model Selection ---
DEFAULT_MODEL="OPENAI"

# --- API Keys ---
OPENAI_API_KEY="sk-..."
LLAMA_CLOUD_API_KEY="ll-..."

# --- DB Collection ---
# ì±„íŒ… APIì—ì„œ ì‚¬ìš©í•  ê¸°ë³¸ ì»¬ë ‰ì…˜ ì´ë¦„ì…ë‹ˆë‹¤.
# ê°œë°œìê°€ ì´ ê°’ì„ ì§ì ‘ ìˆ˜ì •í•˜ì—¬ ì±—ë´‡ì˜ ì§€ì‹ ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
DEFAULT_DB_COLLECTION_NAME="lecture-2025-2"
```

### 3. ì„œë²„ ì‹¤í–‰

ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì•„ë˜ ëª…ë ¹ì–´ë¡œ FastAPI ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
uvicorn main:app --reload
```

ì„œë²„ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ `http://127.0.0.1:8000/docs` ë¡œ ì ‘ì†í•˜ì—¬ API ë¬¸ì„œë¥¼ í™•ì¸í•˜ê³  í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## âš™ï¸ Git Ignore ì„¤ì • (`.gitignore`)

í”„ë¡œì íŠ¸ë¥¼ Gitìœ¼ë¡œ ê´€ë¦¬í•  ë•Œ, ë¯¼ê°í•œ ì •ë³´(API í‚¤), ë¶ˆí•„ìš”í•œ íŒŒì¼, ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë°ì´í„°ê°€ ì €ì¥ì†Œì— í¬í•¨ë˜ì§€ ì•Šë„ë¡ `.gitignore` íŒŒì¼ì„ ì„¤ì •í•˜ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. í”„ë¡œì íŠ¸ ìµœìƒìœ„ ê²½ë¡œì— **`.gitignore`** ë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.

```gitignore
# ---------------------------------
# .gitignore
# ---------------------------------

# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼
# API í‚¤ì™€ ê°™ì€ ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì ˆëŒ€ Gitì— ì˜¬ë¦¬ë©´ ì•ˆ ë©ë‹ˆë‹¤.
.env

# Python ê°€ìƒ í™˜ê²½ í´ë”
# ê°ìì˜ ì»´í“¨í„° í™˜ê²½ì— ë”°ë¼ ë‚´ìš©ì´ ë‹¤ë¥´ë©°, requirements.txtë¥¼ í†µí•´ ì¬ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.
venv/
/venv/

# Python ìºì‹œ ë° ì»´íŒŒì¼ íŒŒì¼
# ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë¶ˆí•„ìš”í•œ íŒŒì¼ì…ë‹ˆë‹¤.
__pycache__/
*.pyc

# ìë™ ìƒì„± ë°ì´í„° í´ë”
# ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ íŒŒì¼ê³¼ ìƒì„±ëœ ë²¡í„° DBëŠ” ì†ŒìŠ¤ ì½”ë“œê°€ ì•„ë‹™ë‹ˆë‹¤.
uploads/
chroma_db_combined/

# IDE / í¸ì§‘ê¸° ì„¤ì • íŒŒì¼
# ê°œì¸ì˜ ê°œë°œ í™˜ê²½ ì„¤ì •ì„ ê³µìœ í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.
.vscode/
.idea/

# macOS ì‹œìŠ¤í…œ íŒŒì¼
.DS_Store
```

---

## ğŸ“– API ì‚¬ìš© ê°€ì´ë“œ

APIëŠ” í¬ê²Œ ë‘ ê°€ì§€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤: **PDF ì²˜ë¦¬ ë° DB êµ¬ì¶•**ê³¼ **ì±„íŒ…**.

### 1ë‹¨ê³„: PDF ì²˜ë¦¬ ë° ì§€ì‹ ì»¬ë ‰ì…˜ êµ¬ì¶•

ë¨¼ì € ì§ˆë¬¸ì˜ ê¸°ë°˜ì´ ë  PDF íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë²¡í„° DBì— ì§€ì‹ ì»¬ë ‰ì…˜ì„ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” íŒŒì¼ê³¼ í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í•¨ê»˜ ì „ì†¡í•˜ê¸° ìœ„í•´ **`multipart/form-data`** í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

* **Endpoint**: `POST /api/v1/processing/process-pdf`
* **ìš”ì²­ í˜•ì‹**: `multipart/form-data`
* **í¼ í•„ë“œ (Form Fields)**:
    * `collection_name` (string, í•„ìˆ˜): ìƒì„±í•  ì§€ì‹ ì»¬ë ‰ì…˜ì˜ ê³ ìœ í•œ ì´ë¦„.
    * `file` (file, í•„ìˆ˜): ì—…ë¡œë“œí•  PDF íŒŒì¼.
* **`curl` ì˜ˆì‹œ**:

    ```bash
    curl -X 'POST' \
      '[http://127.0.0.1:8000/api/v1/processing/process-pdf](http://127.0.0.1:8000/api/v1/processing/process-pdf)' \
      -H 'accept: application/json' \
      -F 'collection_name=lecture-2025-2' \
      -F 'file=@/ê²½ë¡œ/ë‚´/íŒŒì¼.pdf'
    ```

> #### ğŸ’¡ ìƒì„¸ ì‚¬ìš©ë²•: UIë¡œ ì‰½ê²Œ íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°
>
> `curl` ëª…ë ¹ì–´ê°€ ìµìˆ™í•˜ì§€ ì•Šë‹¤ë©´, ì„œë²„ ì‹¤í–‰ í›„ `http://127.0.0.1:8000/docs`ì— ì ‘ì†í•˜ì„¸ìš”. `POST /api/v1/processing/process-pdf` í•­ëª©ì„ ì—´ê³  "Try it out" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì›¹ í™”ë©´ì—ì„œ ì§ì ‘ ì»¬ë ‰ì…˜ ì´ë¦„ì„ ì…ë ¥í•˜ê³  íŒŒì¼ì„ ì„ íƒí•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> 

### 2ë‹¨ê³„: ì±„íŒ… (ì§ˆì˜ì‘ë‹µ)

ì§€ì‹ ì»¬ë ‰ì…˜ êµ¬ì¶•ì´ ì™„ë£Œë˜ë©´, `.env` íŒŒì¼ì— ì„¤ì •ëœ ì»¬ë ‰ì…˜ì„ ëŒ€ìƒìœ¼ë¡œ ì§ˆë¬¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” í…ìŠ¤íŠ¸ ë°ì´í„°ë§Œ ì£¼ê³ ë°›ìœ¼ë¯€ë¡œ **`application/json`** í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

* **Endpoint**: `POST /api/v1/chat/chat`
* **ìš”ì²­ í˜•ì‹**: `application/json`
* **ìš”ì²­ ë³¸ë¬¸ (JSON)**:

    ```json
    {
      "question": "ì»´í“¨í„°ê³¼í•™ê³¼ ì¡¸ì—… ìš”ê±´ì— ëŒ€í•´ì„œ ì•Œë ¤ì¤˜."
    }
    ```
* **`curl` ì˜ˆì‹œ**:

    ```bash
    curl -X 'POST' \
      '[http://127.0.0.1:8000/api/v1/chat/chat](http://127.0.0.1:8000/api/v1/chat/chat)' \
      -H 'accept: application/json' \
      -H 'Content-Type: application/json' \
      -d '{
      "question": "ì»´í“¨í„°ê³¼í•™ê³¼ ì¡¸ì—… ìš”ê±´ì— ëŒ€í•´ì„œ ì•Œë ¤ì¤˜."
    }'
    ```

---

## ğŸ¤” ë¬¸ì œ í•´ê²° (Troubleshooting)

#### `422 Unprocessable Entity` ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë‚˜ìš”?

ì´ ì˜¤ë¥˜ëŠ” APIë¡œ ë³´ë‚¸ ìš”ì²­ ë°ì´í„°ì˜ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤. ì£¼ë¡œ JSON ë¬¸ë²• ì˜¤ë¥˜ê°€ ì›ì¸ì…ë‹ˆë‹¤.

* **âŒ ì˜ëª»ëœ ì˜ˆì‹œ (ë§ˆì§€ë§‰ì— ì‰¼í‘œê°€ ìˆìŒ):** `{ "question": "ì§ˆë¬¸ ë‚´ìš©.", }`
* **âŒ ì˜ëª»ëœ ì˜ˆì‹œ (ê°’ì˜ ì‹œì‘ ë”°ì˜´í‘œê°€ ì—†ìŒ):** `{ "question": ì§ˆë¬¸ ë‚´ìš©" }`
* **âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ:** `{ "question": "ì§ˆë¬¸ ë‚´ìš©" }`

#### `ModuleNotFoundError` ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë‚˜ìš”?

í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì•„ë˜ ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”.

1.  **ê°€ìƒ í™˜ê²½(`venv`)ì´ í™œì„±í™”**ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
2.  `pip install -r requirements.txt` ëª…ë ¹ì–´ë¡œ ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì˜ ì„¤ì¹˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì„±

### ìµœì¢… `requirements.txt`

```text
# requirements.txt
fastapi
uvicorn[standard]
python-dotenv
pdf2docx
llama-parse
python-docx
beautifulsoup4
pandas
lxml
html5lib
langchain
langchain-openai
langchain-chroma
langchain-teddynote
scikit-learn
tiktoken
langchain-community
python-multipart
```

### ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
/rag_fastapi_project
|
â”œâ”€â”€ main.py
â”œâ”€â”€ .env
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â”œâ”€â”€ .gitignore
|
â”œâ”€â”€ core/
â”‚   â””â”€â”€ config.py
|
â”œâ”€â”€ models/
â”‚   â””â”€â”€ llm_factory.py
|
â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ chat_router.py
â”‚   â””â”€â”€ processing_router.py
|
â”œâ”€â”€ schemas/
â”‚   â””â”€â”€ chat_schema.py
|
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ chat_service.py
â”‚   â”œâ”€â”€ file_processing_service.py
â”‚   â””â”€â”€ vector_store_service.py
|
â”œâ”€â”€ uploads/  (ìë™ ìƒì„±)
â””â”€â”€ chroma_db_combined/ (ìë™ ìƒì„±)
```